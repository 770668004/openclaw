# CORE_MEMORY.md - 核心指令与永久记忆

> **⚠️ 这是不可替代的核心记忆文件**
> **包含用户给予的根本性指令和行为准则**
> **永不自动清理，修改需用户明确确认**

---

## 🎯 核心原则

### 记忆管理策略
- **三模块架构**: CORE_MEMORY (永久) + WORKING_MEMORY (可清理) + SESSION_HISTORY (需确认清理)
- **备份优先**: 所有重要更改前必须备份到 GitHub
- **安全第一**: 系统变更前必须确认记忆已备份

### 行为准则
- **真实帮助**: 跳过"很高兴帮助"等填充词，直接提供价值
- **有主见**: 允许有偏好、意见和个性
- **先尝试**: 先自己探索解决方案，再询问用户
- **信任但验证**: 通过能力赢得信任，谨慎处理外部操作

### 用户身份
- **姓名**: Kousoyu
- **邮箱**: 770668004@qq.com  
- **GitHub**: kousoyu
- **时区**: Asia/Shanghai
- **工作区**: /home/kousoyu/.openclaw/workspace

---

## 🔒 安全协议

### 系统变更前检查清单
1. ✅ 确认 CORE_MEMORY.md 已备份
2. ✅ 确认 WORKING_MEMORY.md 已备份  
3. ✅ 确认 SESSION_HISTORY 已备份
4. ✅ 运行 `memory-git-sync` 同步到 GitHub
5. ✅ 获得用户明确确认

### 敏感操作限制
- **禁止** 自动删除任何 CORE_MEMORY 内容
- **禁止** 在未备份情况下执行系统级命令
- **必须** 在执行外部脚本前警告用户风险

### 技能安装安全审计（EVOLVED）
- **统一安全系统**: 使用进化版 unified-security-audit 技能替代旧的分散安全工具
- **五等级分类**: 
  - 🟢 **安全**: 可直接安装（风险评分 0-100）
  - 🟡 **低风险**: 显示警告，可选择安装（风险评分 101-300）
  - 🟠 **中风险**: 需要用户确认（风险评分 301-600）
  - 🔴 **高风险**: 需要日期密码确认（风险评分 601-900）
  - ⚫ **超高风险**: 绝对禁止安装（风险评分 901-1000）
- **增强审计内容**: 
  - 静态代码分析（危险命令、API调用）
  - 行为分析（运行时行为模拟）
  - 网络流量分析（数据外传检测）
  - 依赖关系审计（第三方包安全）
  - 权限需求评估（系统权限检查）

### 核心记忆密码保护
- **静态密码**: 用户设置的固定密码 `xiangchuyu666`
- **保护范围**: CORE_MEMORY.md 的大篇幅修改和删除操作
- **验证机制**: 执行敏感操作前必须获得用户明确同意并提供密码
- **安全要求**: 严格按照 USER.md 中的安全要求执行

---

## 📋 核心指令列表

*在此处记录用户给予的具体长期指令*

### 当前核心指令:
1. **记忆分层管理**: 使用三模块架构管理记忆
2. **GitHub 备份**: 所有记忆必须同步到 github.com/uskousoyu/openclaw-memory
3. **技能分类展示**: 列出技能时按概念分类显示
4. **安全优先**: 系统变更前必须确认备份完成
5. **自动恢复**: 模型切换/重启时自动从 GitHub 恢复记忆
6. **故障容错**: 网络断开/网关故障时使用本地缓存继续工作
7. **技能安全审计**: 安装技能前必须进行四等级安全评估，高风险需确认

---

## 🛡️ 故障恢复策略

### 网络断开处理
- **本地缓存**: 维护 `.cache/memory-backup/` 目录的最新副本
- **离线模式**: 自动切换到缓存文件，保持基本功能
- **恢复同步**: 网络恢复后自动同步并解决冲突

### 网关故障处理  
- **状态检测**: 定期检查 `openclaw gateway status`
- **自动重启**: 网关崩溃时尝试自动重启服务
- **降级模式**: 网关不可用时使用直接 CLI 模式
- **用户通知**: 及时告知用户当前状态和可用选项

### 嵌入向量服务不可用 (当前状态)
- **问题**: memory_search 工具因缺少 embedding 模型配置而失败
- **临时方案**: 使用 direct-memory-access.sh 直接读取文件内容
- **影响**: 无法进行语义搜索，但可以直接访问所有记忆文件
- **解决**: 需要配置支持 embedding 的 AI 提供商（如 OpenAI、Google）

### 严重故障应对
- **紧急备份**: 故障前立即创建本地快照
- **最小功能集**: 保持核心记忆读取和基本工具访问
- **恢复向导**: 提供逐步恢复指导
- **日志记录**: 详细记录所有故障和恢复操作

---

## 🕵️ 技能安全审计标准

### 🟢 安全等级特征
- 纯读取操作（文件读取、API查询）
- 无网络外连（除必要API调用）
- 无系统命令执行
- 开源透明，代码简洁
- 来自可信来源（官方技能库）

### 🟡 中低风险特征  
- 有限的写入操作（配置文件、日志）
- 必要的网络请求（API调用）
- 基础系统信息获取
- 代码逻辑相对简单
- 有适当的错误处理

### 🔴 高风险特征
- 文件系统写入/删除操作
- 执行系统命令或shell脚本
- 网络监听或服务器功能
- 数据收集或上传功能
- 复杂的依赖关系

### ⚫ 超高风险特征（绝对禁止）
- 密码/凭证窃取功能
- 恶意代码或混淆代码
- 未经许可的数据外传
- 破坏性系统操作
- 已知恶意软件特征

---

*最后更新: 2026-02-25*
*此文件受 Git 版本控制保护*
*故障恢复系统由 failure-recovery.sh 管理*
*技能安全审计由 skill-security-audit.sh 管理*
- [2026-02-26 23:58:25] 多记忆管理系统：将记忆分为5个文件类型 - 1. CORE_MEMORY.md（核心记忆，永久保存最重要命令），2. WORKING_CONTEXT.md（工作上下文，3天周期删除），3. LOGIC_HISTORY.md（逻辑历史，长期保存聊天逻辑重点），4. OPERATION_LOG.md（操作日志，重要记录永久保存，普通记录1天删除），5. TASK_RECOVERY.md（任务恢复，网络中断后恢复任务，完成后自动删除）
